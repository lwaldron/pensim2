<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Parallelized calculation of cross-validated risk score
  predictions from L1/L2/Elastic Net penalized regression. — opt.nested.crossval • pensim</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Parallelized calculation of cross-validated risk score
  predictions from L1/L2/Elastic Net penalized regression. — opt.nested.crossval"><meta property="og:description" content="calculates risk score predictions by a nested cross-validation, using
  the optL1 and optL2 functions of the penalized R package for
  regression.  In the outer level of cross-validation, samples are split
  into training and test samples.  Model parameters are tuned by cross-validation within
  training samples only.
By setting nprocessors &amp;gt; 1, the outer cross-validation is split between multiple processors.
The functions support z-score scaling of training data, and application
  of these scaling and shifting coefficients to the test data.  It also
  supports repeated tuning of the penalty parameters and selection of the
  model with greatest cross-validated likelihood."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">pensim</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.3.6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/pensim.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/waldronlab/pensim/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Parallelized calculation of cross-validated risk score
  predictions from L1/L2/Elastic Net penalized regression.</h1>
    
    <div class="hidden name"><code>opt.nested.crossval.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>calculates risk score predictions by a nested cross-validation, using
  the optL1 and optL2 functions of the penalized R package for
  regression.  In the outer level of cross-validation, samples are split
  into training and test samples.  Model parameters are tuned by cross-validation within
  training samples only.</p>
<p>By setting nprocessors &gt; 1, the outer cross-validation is split between multiple processors.</p>
<p>The functions support z-score scaling of training data, and application
  of these scaling and shifting coefficients to the test data.  It also
  supports repeated tuning of the penalty parameters and selection of the
  model with greatest cross-validated likelihood.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">opt.nested.crossval</span><span class="op">(</span>outerfold<span class="op">=</span><span class="fl">10</span>, nprocessors<span class="op">=</span><span class="fl">1</span>, cl<span class="op">=</span><span class="cn">NULL</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>outerfold</dt>
<dd><p>number of folds in outer cross-validation (the level used for validation)</p></dd>

  <dt>nprocessors</dt>
<dd><p>An integer number of processors to use.  If specified in 
    opt.nested.crossval, iterations of the outer cross-validation are
    sent to different processors.  If specified in opt.splitval,
    repeated starts for the penalty tuning are sent to different processors.</p></dd>

  <dt>cl</dt>
<dd><p>Optional cluster object created with the makeCluster() function of
    the parallel package.  If this is not set, pensim calls
    makeCluster(nprocessors, type="SOCK").   Setting this parameter
    can enable parallelization in more diverse scenarios than multi-core
    desktops; see the documentation for the parallel package.  Note that if
    cl is user-defined, this function will not automatically run
    parallel::stopCluster() to shut down the cluster.</p></dd>

  <dt>...</dt>
<dd><p>optFUN (either "opt1D" or "opt2D"), scaling (TRUE to z-score
    training data then apply the same shift and scale factors to test
    data, FALSE for no scaling) are passed onto the opt.splitval
    function.  Additional arguments are required, to be passed to the
    optL1 or optL2 function of the penalized R package.  See those help
    pages, and it may be desirable to test these arguments directly on
    optL1 or optL2 before using this more CPU-consuming and complex
    function.</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>This function calculates cross-validated risk score predictions,
  tuning a penalized regression model using the optL1 or optL2 functions
  of the penalized R package, for each iteration of the
  cross-validation.  Tuning is done by cross-validation in the training
  samples only.  Test samples are scaled using the shift and scale
  factors determined from the training samples.  parameter.  If
  nprocessors &gt; 1, it uses the SNOW package for parallelization,
  dividing the iterations of the outer cross-validation among the
  specified number of processors.</p>
<p>Some arguments MUST be passed (through the ... arguments) but which
  are documented for the functions in which they are used.  These
  include, from the opt.splitval function:</p>  
<p>optFUN="opt1D" for Lasso or Ridge regression, or "opt2D" for Elastic
  Net.  See the help pages for opt1D and opt2D for additional
  arguments associated with these functions.</p>    
<p>scaling=TRUE to scale each feature (column) of the training sample to
  z-scores.  These same scaling and shifting factors are applied to the
  test data.  If FALSE, no scaling is done.  Note that only data in the
  penalized argument are scaled, not the optional unpenalized argument
  (see documentation for opt1D, opt2D, or cvl from the penalized package
  for descriptions of the penalized and unpenalized arguments).
  Alternatively, the standardize=TRUE argument to the penalized package
  functions can be used to do scaling internally.</p>
<p>nsim=50 this number specifies the number of times to repeat tuning of
  the penalty parameters on different data foldings for the
  cross-validation.</p>
<p>setpen="L1" or "L2" : if optFUN="opt1D", this sets regression type to
  LASSO or Ridge, respectively.  See ?opt1D.</p>
<p>L1range, L2range, dofirst, L1gridsize, L2gridsize: options for Elastic
  Net regression if optFUN="opt2D".  See ?opt2D.</p>
    </div>
    <div id="value">
    <h2>Value</h2>
    

<p>Returns a vector of cross-validated continuous risk score predictions.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Waldron L, Pintilie M, Tsao M-S, Shepherd FA, Huttenhower C*, Jurisica
  I*: Optimized application of penalized regression methods to diverse
  genomic data. Bioinformatics 2011, 27:3399-3406.  (*equal contribution)</p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Levi Waldron et al.</p>
    </div>
    <div id="note">
    <h2>Note</h2>
    <p>Depends on the R packages: penalized, parallel</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>opt.splitval</p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">beer.exprs</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">beer.survival</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">##select just 100 genes to speed computation:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">beer.exprs.sample</span> <span class="op">&lt;-</span> <span class="va">beer.exprs</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">beer.exprs</span><span class="op">)</span>, <span class="fl">100</span><span class="op">)</span>, <span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">gene.quant</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">beer.exprs.sample</span>, <span class="fl">1</span>, <span class="va">quantile</span>, probs <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dat.filt</span> <span class="op">&lt;-</span> <span class="va">beer.exprs.sample</span><span class="op">[</span><span class="va">gene.quant</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log2</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>, <span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">gene.iqr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">dat.filt</span>, <span class="fl">1</span>, <span class="va">IQR</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dat.filt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">dat.filt</span><span class="op">[</span><span class="va">gene.iqr</span> <span class="op">&gt;</span> <span class="fl">0.5</span>, <span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dat.filt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">dat.filt</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dat.filt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">dat.filt</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">surv.obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">beer.survival</span><span class="op">$</span><span class="va">os</span>, <span class="va">beer.survival</span><span class="op">$</span><span class="va">status</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## First, test the regression arguments using functions from</span></span></span>
<span class="r-in"><span><span class="co">## the penalized package.  I use maxlambda1=5 here to ensure at least</span></span></span>
<span class="r-in"><span><span class="co">## one non-zero coefficient.</span></span></span>
<span class="r-in"><span><span class="va">testfit</span> <span class="op">&lt;-</span> <span class="fu">penalized</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/penalized/man/cvl.html" class="external-link">optL1</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  response <span class="op">=</span> <span class="va">surv.obj</span>,</span></span>
<span class="r-in"><span>  maxlambda1 <span class="op">=</span> <span class="fl">3</span>,</span></span>
<span class="r-in"><span>  penalized <span class="op">=</span> <span class="va">dat.filt</span>,</span></span>
<span class="r-in"><span>  fold <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>  positive <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>  standardize <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  trace <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lambda= 1.145898 	12cvl= -127.4981 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lambda= 1.854102 	12cvl= -120.1576 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lambda= 2.291796 	12cvl= -117.5577 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lambda= 2.841986 	12cvl= -115.7448 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lambda= 2.631832 	12cvl= -116.3155 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lambda= 2.761715 	12cvl= -115.9482 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lambda= 2.902342 	12cvl= -115.6034 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lambda= 2.939644 	12cvl= -115.5208 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lambda= 2.962698 	12cvl= -115.4716 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lambda= 2.976946 	12cvl= -115.4419 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lambda= 2.985752 	12cvl= -115.4238 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lambda= 2.991194 	12cvl= -115.4127 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lambda= 2.994558 	12cvl= -115.4059 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lambda= 2.996636 	12cvl= -115.4017 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lambda= 2.997921 	12cvl= -115.3991 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lambda= 2.998715 	12cvl= -115.3975 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lambda= 2.999206 	12cvl= -115.3966 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lambda= 2.999509 	12cvl= -115.3961 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Now pass these arguments to opt.nested.splitval() for cross-validated</span></span></span>
<span class="r-in"><span><span class="co">## calculation and assessment of risk scores, with the additional</span></span></span>
<span class="r-in"><span><span class="co">## arguments:</span></span></span>
<span class="r-in"><span><span class="co">##    outerfold and nprocessors (?opt.nested.crossval)</span></span></span>
<span class="r-in"><span><span class="co">##    optFUN and scaling (?opt.splitval)</span></span></span>
<span class="r-in"><span><span class="co">##    setpen and nsim (?opt1D)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Ideally nsim would be 50, and outerfold and fold would be 10, but the</span></span></span>
<span class="r-in"><span><span class="co">## values below speed computation 200x compared to these recommended</span></span></span>
<span class="r-in"><span><span class="co">## values.  Note that here we are using the standardize=TRUE argument of</span></span></span>
<span class="r-in"><span><span class="co">## optL1 rather than the scaling=TRUE argument of opt.splitval.  These</span></span></span>
<span class="r-in"><span><span class="co">## two approaches to scaling are roughly equivalent, but the scaling</span></span></span>
<span class="r-in"><span><span class="co">## approaches are not the same (scaling=TRUE does z-score,</span></span></span>
<span class="r-in"><span><span class="co">## standardize=TRUE scales to unit central L2 norm), and results will</span></span></span>
<span class="r-in"><span><span class="co">## not be identical.  Also, using standardize=TRUE scales variables but</span></span></span>
<span class="r-in"><span><span class="co">## provides coeffients for the original scale, whereas using</span></span></span>
<span class="r-in"><span><span class="co">## scaling=TRUE scales variables in the training set then applies the</span></span></span>
<span class="r-in"><span><span class="co">## same scales to the test set.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## In this example I use two processors:</span></span></span>
<span class="r-in"><span><span class="va">preds</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="fu">pensim</span><span class="fu">::</span><span class="fu">opt.nested.crossval</span><span class="op">(</span></span></span>
<span class="r-in"><span>    outerfold <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>    nprocessors <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>    <span class="co">#opt.nested.crossval arguments</span></span></span>
<span class="r-in"><span>    optFUN <span class="op">=</span> <span class="st">"opt1D"</span>,</span></span>
<span class="r-in"><span>    scaling <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>    <span class="co">#opt.splitval arguments</span></span></span>
<span class="r-in"><span>    setpen <span class="op">=</span> <span class="st">"L1"</span>,</span></span>
<span class="r-in"><span>    nsim <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>    <span class="co">#opt1D arguments</span></span></span>
<span class="r-in"><span>    response <span class="op">=</span> <span class="va">surv.obj</span>,</span></span>
<span class="r-in"><span>    <span class="co">#rest are penalized::optl1 arguments</span></span></span>
<span class="r-in"><span>    penalized <span class="op">=</span> <span class="va">dat.filt</span>,</span></span>
<span class="r-in"><span>    fold <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>    maxlambda1 <span class="op">=</span> <span class="fl">5</span>,</span></span>
<span class="r-in"><span>    positive <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>    standardize <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>    trace <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## We probably also want the coefficients from the model fit on all the</span></span></span>
<span class="r-in"><span><span class="co">## data, for future use:</span></span></span>
<span class="r-in"><span><span class="va">beer.coefs</span> <span class="op">&lt;-</span> <span class="fu">pensim</span><span class="fu">::</span><span class="fu"><a href="opt1D.html">opt1D</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  setpen <span class="op">=</span> <span class="st">"L1"</span>,</span></span>
<span class="r-in"><span>  nsim <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>  maxlambda1 <span class="op">=</span> <span class="fl">5</span>,</span></span>
<span class="r-in"><span>  response <span class="op">=</span> <span class="va">surv.obj</span>,</span></span>
<span class="r-in"><span>  penalized <span class="op">=</span> <span class="va">dat.filt</span>,</span></span>
<span class="r-in"><span>  fold <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>  positive <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>  standardize <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  trace <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## We can also include unpenalized covariates, if desired.</span></span></span>
<span class="r-in"><span><span class="co">## Note that when keeping only one variable for a penalized or</span></span></span>
<span class="r-in"><span><span class="co">## unpenalized covariate, indexing a dataframe like [1] instead of doing</span></span></span>
<span class="r-in"><span><span class="co">## [,1] preserves the variable name.  With [,1] the variable name gets</span></span></span>
<span class="r-in"><span><span class="co">## converted to "".</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">beer.coefs</span> <span class="op">&lt;-</span> <span class="fu">pensim</span><span class="fu">::</span><span class="fu"><a href="opt1D.html">opt1D</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  setpen <span class="op">=</span> <span class="st">"L1"</span>,</span></span>
<span class="r-in"><span>  nsim <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>  maxlambda1 <span class="op">=</span> <span class="fl">5</span>,</span></span>
<span class="r-in"><span>  response <span class="op">=</span> <span class="va">surv.obj</span>,</span></span>
<span class="r-in"><span>  penalized <span class="op">=</span> <span class="va">dat.filt</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>  <span class="co"># This is equivalent to dat.filt[, -1]</span></span></span>
<span class="r-in"><span>  unpenalized <span class="op">=</span> <span class="va">dat.filt</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>  fold <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>  positive <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>  standardize <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  trace <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## (note the non-zero first coefficient this time, due to it being unpenalized).</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Summarization and plotting.</span></span></span>
<span class="r-in"><span><span class="va">preds.dichot</span> <span class="op">&lt;-</span> <span class="va">preds</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">preds</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">coxfit.continuous</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="va">surv.obj</span> <span class="op">~</span> <span class="va">preds</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">coxfit.dichot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="va">surv.obj</span> <span class="op">~</span> <span class="va">preds.dichot</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">coxfit.continuous</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> coxph(formula = surv.obj ~ preds)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   n= 86, number of events= 24 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         coef exp(coef) se(coef)     z Pr(&gt;|z|)   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> preds 1.1001    3.0044   0.3964 2.775  0.00552 **</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       exp(coef) exp(-coef) lower .95 upper .95</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> preds     3.004     0.3328     1.382     6.534</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Concordance= 0.713  (se = 0.058 )</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Likelihood ratio test= 8.52  on 1 df,   p=0.004</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Wald test            = 7.7  on 1 df,   p=0.006</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Score (logrank) test = 8.49  on 1 df,   p=0.004</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">coxfit.dichot</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> coxph(formula = surv.obj ~ preds.dichot)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   n= 86, number of events= 24 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                    coef exp(coef) se(coef)     z Pr(&gt;|z|)  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> preds.dichotTRUE 0.9573    2.6046   0.4341 2.205   0.0275 *</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                  exp(coef) exp(-coef) lower .95 upper .95</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> preds.dichotTRUE     2.605     0.3839     1.112     6.099</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Concordance= 0.633  (se = 0.049 )</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Likelihood ratio test= 5.22  on 1 df,   p=0.02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Wald test            = 4.86  on 1 df,   p=0.03</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Score (logrank) test = 5.24  on 1 df,   p=0.02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">nobs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">preds</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">cutoff</span> <span class="op">&lt;-</span> <span class="fl">12</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"survivalROC"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="va">preds.roc</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="fu">survivalROC</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survivalROC/man/survivalROC.html" class="external-link">survivalROC</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    Stime <span class="op">=</span> <span class="va">beer.survival</span><span class="op">$</span><span class="va">os</span>,</span></span>
<span class="r-in"><span>    status <span class="op">=</span> <span class="va">beer.survival</span><span class="op">$</span><span class="va">status</span>,</span></span>
<span class="r-in"><span>    marker <span class="op">=</span> <span class="va">preds</span>,</span></span>
<span class="r-in"><span>    predict.time <span class="op">=</span> <span class="va">cutoff</span>,</span></span>
<span class="r-in"><span>    span <span class="op">=</span> <span class="fl">0.25</span> <span class="op">*</span> <span class="va">nobs</span> <span class="op">^</span> <span class="op">(</span><span class="op">-</span><span class="fl">0.20</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">preds.roc</span><span class="op">$</span><span class="va">FP</span>,</span></span>
<span class="r-in"><span>  <span class="va">preds.roc</span><span class="op">$</span><span class="va">TP</span>,</span></span>
<span class="r-in"><span>  type <span class="op">=</span> <span class="st">"l"</span>,</span></span>
<span class="r-in"><span>  xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  lty <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"FP"</span>, <span class="st">"\n"</span>, <span class="st">"AUC = "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">preds.roc</span><span class="op">$</span><span class="va">AUC</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  ylab <span class="op">=</span> <span class="st">"TP"</span>,</span></span>
<span class="r-in"><span>  main <span class="op">=</span> <span class="st">"LASSO predictions\n ROC curve at 12 months"</span></span></span>
<span class="r-in"><span> <span class="op">)</span></span></span>
<span class="r-in"><span> <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="op">}</span></span></span>
<span class="r-plt img"><img src="opt.nested.crossval-1.png" alt="" width="700" height="433"></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Levi Waldron.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer></div>

  


  

  </body></html>

